<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title> Ú¤Ù„Ù‡</title>
<link rel="icon" type="image/png" href="/image/logo2.png" />
<link rel="stylesheet" href="../../styles.css" />
<script src="../../ether.js" defer></script>

<style>
  :root{
    --bg-dark: rgba(0,0,0,0.45);
    --panel: rgba(0,0,0,0.55);
    --stroke: rgba(255,255,255,0.08);
    --text: #fff;

    /* Wordle-like colors (ØªÙ‚Ø¯Ø± ØªØºÙŠØ±Ù‡Ø§ Ù„Ø§Ø­Ù‚Ù‹Ø§) */
    --good: #6aaa64;     /* ØµØ­ + Ù…ÙƒØ§Ù†Ù‡ ØµØ­ */
    --close: #c9b458;    /* ØµØ­ + Ù…ÙƒØ§Ù† ØºÙ„Ø· */
    --bad: #3a3a3c;      /* ØºÙ„Ø· */
    --cell: rgba(255,255,255,0.06);
    --cell-border: rgba(255,255,255,0.12);
    --accent: #2ad3d8;
  }

  body{
    margin:0; background:#000; color:var(--text);
    font-family:"Cairo", system-ui, sans-serif;
  }

  /* Ù†ÙØ³ ØªÙˆØ¨ Ø¨Ø§Ø± Ù…ÙˆÙ‚Ø¹Ùƒ */
  .site-title{ color:#fff; font-weight:900; font-size:1.2rem; }

  .game-area{ padding:30px; display:flex; justify-content:center; }
  .game-box{
    width:100%; max-width:900px;
    height: 100%;
    background: var(--bg-dark);
    border-radius:24px; padding:18px;
    border:1px solid var(--stroke);
    backdrop-filter: blur(6px);
  }

  .mode-bar{
    display:flex; gap:8px; justify-content:center; margin-bottom:12px;
  }
  .mode-btn{
    padding:8px 14px; border-radius:10px; border:1px solid rgba(255,255,255,0.18);
    background: rgba(0,0,0,0.6); color:#fff; cursor:pointer; font-weight:900;
    transition:.15s;
  }
  .mode-btn.active{ background: var(--accent); color:#000; }

  .hint{
    text-align:center; font-weight:900; opacity:.9; margin:6px 0 14px;
  }

  .board-wrap{
    display:flex; justify-content:center;
  }
  .board{
    display:grid; gap:8px;
    padding:12px 10px;
    background: rgba(0,0,0,0.35);
    border-radius:14px; border:1px solid var(--stroke);
  }
  .row{
    display:grid; gap:8px;
  }
  .cell{
    width:58px; height:58px;
    display:flex; align-items:center; justify-content:center;
    background: var(--cell);
    border:2px solid var(--cell-border);
    border-radius:10px;
    font-size:2rem; font-weight:900;
    transition: .25s;
    user-select:none;
  }
  .cell.filled{
    border-color: rgba(255,255,255,0.35);
  }
  .cell.good{ background: var(--good); border-color: var(--good); color:#fff; }
  .cell.close{ background: var(--close); border-color: var(--close); color:#fff; }
  .cell.bad{ background: var(--bad); border-color: var(--bad); color:#fff; }

  /* Ø§Ù‡ØªØ²Ø§Ø² ØºÙ„Ø· */
  .row.shake{ animation: shake .35s linear; }
  @keyframes shake{
    0%,100%{ transform:translateX(0); }
    20%{ transform:translateX(8px); }
    40%{ transform:translateX(-8px); }
    60%{ transform:translateX(6px); }
    80%{ transform:translateX(-6px); }
  }

  /* ÙƒÙŠØ¨ÙˆØ±Ø¯ Ø¹Ø±Ø¨ÙŠ Ø·Ø¨ÙŠØ¹ÙŠ */
  .keyboard{
    margin-top:16px;
    display:flex; flex-direction:column; gap:8px; align-items:center;
  }
  .kb-row{ display:flex; gap:6px; flex-wrap:wrap; justify-content:center; }
  .key{
    min-width:42px; height:52px;
    padding:0 10px;
    border-radius:10px; border:1px solid rgba(255,255,255,0.12);
    background: rgba(255,255,255,0.08);
    color:#fff; font-weight:900; font-size:1.15rem;
    display:flex; align-items:center; justify-content:center;
    cursor:pointer; user-select:none; transition:.12s;
  }
  .key:hover{ transform:translateY(-1px); }
  .key.wide{ min-width:90px; font-size:1rem; }

  .key.good{ background: var(--good); border-color: var(--good); }
  .key.close{ background: var(--close); border-color: var(--close); }
  .key.bad{ background: var(--bad); border-color: var(--bad); }

  .message{
    margin-top:12px; text-align:center; font-weight:900; min-height:26px;
  }

  /* Overlay Ù†Ù‡Ø§ÙŠØ©/ÙÙˆØ² */
  .overlay{
    position:fixed; inset:0; background:rgba(0,0,0,.7);
    display:none; align-items:center; justify-content:center; z-index:999;
  }
  .overlay-card{
    width:min(520px,94vw);
    background:rgba(10,10,18,.95);
    border:1px solid rgba(255,255,255,.12);
    border-radius:18px; padding:18px; text-align:center; color:#fff;
  }
  .overlay-card h3{ margin:0 0 8px; font-size:1.8rem; }
  .overlay-card p{ margin:0 0 12px; opacity:.95; }
  .btnx{
    padding:10px 16px; border-radius:12px; cursor:pointer;
    background: rgba(255,255,255,0.12);
    border:1px solid rgba(255,255,255,0.2);
    color:#fff; font-weight:800;
  }

  @media (max-width:600px){
    .cell{ width:48px; height:48px; font-size:1.6rem; }
    .key{ min-width:36px; height:46px; }
    .key.wide{ min-width:78px; }
  }
</style>
</head>

<body>
<canvas id="ether-bg" aria-hidden="true"></canvas>

<div class="top-bar">
  <div class="back-btn" onclick="window.location.href='../../games.html'">Ø±Ø¬ÙˆØ¹</div>

  <!-- âœ… ØµÙ†Ø¯ÙˆÙ‚ Ø­Ø³Ø§Ø¨ ØªÙˆÙŠØªØ´ -->
  <div class="twitch-user-box" id="twitchUserBox">
    <img id="twitchAvatar" src="">
    <span id="twitchUsername">ØºÙŠØ± Ù…Ø³Ø¬Ù‘Ù„</span>
  </div>

  <h2 class="site-title">Ø§Ù„Ø£Ù„Ø¹Ø§Ø¨</h2>
</div>

<div class="game-area">
  <div class="game-box">

    <div class="mode-bar">
      <button class="mode-btn active" id="mode4">Ù¤ Ø­Ø±ÙˆÙ</button>
      <button class="mode-btn" id="mode5">Ù¥ Ø­Ø±ÙˆÙ</button>
    </div>

    <div class="hint" id="dailyHint">Ø®Ù…Ù† ÙƒÙ„Ù…Ø© Ø§Ù„ÙŠÙˆÙ…</div>

    <div class="board-wrap">
      <div class="board" id="board"></div>
    </div>

    <div class="keyboard" id="keyboard"></div>

    <div class="message" id="message"></div>

  </div>
</div>

<div class="overlay" id="overlay">
  <div class="overlay-card">
    <h3 id="overlayTitle"></h3>
    <p id="overlayText"></p>
    <button class="btnx" id="overlayBtn">Ø­Ø³Ù†Ø§Ù‹</button>
  </div>
</div>

<script>
/* =========================
   V9 Wordle Arabic
   Ø¹Ø§Ù„Ù… Ú¤Ù„Ù‡
========================= */

/* ===== Ù…Ø¹Ø¬Ù… Ø§Ù„ÙƒÙ„Ù…Ø§Øª =====
   - Ù„Ø§Ø²Ù… ØªÙƒÙˆÙ† ÙƒÙ„Ù…Ø§Øª Ø¨Ø¯ÙˆÙ† Ù…Ø³Ø§ÙØ§Øª
   - ÙƒÙ„ ÙƒÙ„Ù…Ø© Ø¨Ù†ÙØ³ Ø§Ù„Ø·ÙˆÙ„
   - Ø²ÙˆØ¯ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø¨Ø±Ø§Ø­ØªÙƒ
*/
const WORDS_4 = [
  "Ù…Ø¯Ø±Ø³","Ù‚Ù„Ù…Ùƒ","ÙˆØ±Ø¯Ù„","Ø¹Ø§Ù„Ù…","ÙÙ„Ù‘Ù‡","Ù†Ø¬Ù…Ùƒ","ÙˆÙ‚ØªÙ†","Ø´Ù…Ø³","Ø¨Ø­Ø±","ØµÙ…Øª",
  "Ù‚Ù„Ø¨Ùƒ","ØµÙ‚Ø±","Ù†Ø§Ø±Ùƒ","ØµÙŠÙ","Ø´ØªØ§","Ù„ÙŠÙ„","Ù†Ù‡Ø§Ø±","Ø¨ÙŠØª","Ø³ÙŠÙ","Ù†ÙˆØ±Ùƒ",
  "Ø­Ù„Ù…","ÙƒØ±Ù‡","Ø¶Ø­Ùƒ","ØµØ¯Ù‚","Ø®ÙˆÙ","Ø­Ø²Ù†","Ù„Ø¹Ø¨","Ù…Ø·Ø±","Ø³Ù‡Ù„","ØµØ¹Ø¨",
  "Ù‚Ù…Ø±","ØµØ¯Ù‰","Ø¯Ø±Ø³","Ù…ÙˆØ¬","Ø±ÙŠØ­","Ø¹ÙŠÙ†","ÙŠØ¯Ùƒ","Ø±Ø¯Ù‡","ØµÙˆØª","Ø±Ù…Ù„",
];

const WORDS_5 = [
  "Ù…Ø¯Ø±Ø³Ø©","Ø³ÙŠØ§Ø±Ø©","Ø´Ø§ÙˆØ±Ù…","Ù…ÙƒØªØ¨Ø©","Ù‚Ù…Ø±ÙŠØ©","Ù…Ø·Ø±Ø§Øª","Ù„Ø¹Ø¨Ø§Øª","Ø§Ù„ÙˆØ§Ù†","Ø·ÙŠØ±Ø§Ù†","Ø¹Ø¬Ù„Ø©",
  "ÙÙƒØ±Ø©","Ø¹Ø¯Ø³Ø§Øª","Ø§Ø³Ø¦Ù„Ø©","ØªØ­Ø¯ÙŠ","Ù…ØºØ§Ù…Ø±","Ø°ÙƒØ§Ø¡","Ù…ÙØ§ØªÙŠ","Ø¬ÙˆØ§Ù„Ùƒ","ÙƒÙ„Ù…Ø§Øª","Ù‚ØµØµÙƒ",
  "Ø³Ø±ÙŠØ¹Ø©","ØµØ¹ÙˆØ¨Ø©","Ù†Ø¬ÙˆÙ…ÙŠ","ÙØ±Ø­Ø§Ù†","Ø¶Ø­ÙƒØ§Øª","Ø­ÙƒØ§ÙŠØ©","Ø­Ù…Ø§Ø³","Ù…ÙˆØ³ÙŠ","ØªÙˆÙŠØªØ´","Ø´ÙØ±Ø©",
  "Ø¹Ø±Ø¨Ø§Øª","Ø´Ø¹Ø§Ø±ÙŠ","Ù‚ÙˆØ§ÙÙ„","Ù…Ø±Ø§ÙƒØ²","Ø­Ø¯Ø§Ø¦Ù‚","Ù‚Ø²Ø§Ø²Ø©","Ù…Ø¯Ø§ÙØ¹","ØµÙ†Ø§Ø¯ÙŠ","Ø§Ø³ÙˆØ¯Ùƒ","Ø§Ø®Ø¶Ø±",
];

/* ===== ÙƒÙŠØ¨ÙˆØ±Ø¯ Ø¹Ø±Ø¨ÙŠ Ø·Ø¨ÙŠØ¹ÙŠ ===== */
const KB_LAYOUT = [
  ["Ø¶","Øµ","Ø«","Ù‚","Ù","Øº","Ø¹","Ù‡","Ø®","Ø­","Ø¬","Ø¯"],
  ["Ø´","Ø³","ÙŠ","Ø¨","Ù„","Ø§","Øª","Ù†","Ù…","Ùƒ","Ø·"],
  ["Enter","Ø¦","Ø¡","Ø¤","Ø±","Ù„Ø§","Ù‰","Ø©","Ùˆ","Ø²","Ø¸","Backspace"]
];

const MAX_TRIES = 6;

/* ===== DOM ===== */
const boardEl = document.getElementById("board");
const keyboardEl = document.getElementById("keyboard");
const msgEl = document.getElementById("message");

const mode4Btn = document.getElementById("mode4");
const mode5Btn = document.getElementById("mode5");

const overlay = document.getElementById("overlay");
const overlayTitle = document.getElementById("overlayTitle");
const overlayText = document.getElementById("overlayText");
const overlayBtn = document.getElementById("overlayBtn");

/* ===== Ø­Ø§Ù„Ø© Ø§Ù„Ù„Ø¹Ø¨Ø© ===== */
let mode = 4;
let words = WORDS_4;
let answer = "";
let normalizedAnswer = "";

let row = 0;
let col = 0;
let grid = [];
let done = false;

let keyStates = {}; // letter -> "good|close|bad"

/* ===== Arabic normalize ===== */
function normalizeArabic(s){
  if(!s) return "";
  return s
    .replace(/[\u064B-\u0652\u0670]/g,"")    // ØªØ´ÙƒÙŠÙ„
    .replace(/[Ø£Ø¥Ø¢]/g,"Ø§")
    .replace(/Ù‰/g,"ÙŠ")
    .replace(/Ø¤/g,"Ùˆ")
    .replace(/Ø¦/g,"ÙŠ")
    .replace(/Ø©/g,"Ù‡")
    .replace(/Ù€/g,"")
    .trim();
}

/* ===== ÙŠÙˆÙ… Ø§Ù„Ù„Ø¹Ø¨Ø© (ÙŠØªØºÙŠØ± 00:01 Ù…Ø­Ù„ÙŠ) ===== */
function getDayNumber(){
  const now = new Date();
  const shifted = new Date(now.getTime() - 60*1000); // Ù‚Ø¨Ù„ Ø¯Ù‚ÙŠÙ‚Ø©
  const localMidnight = new Date(shifted.getFullYear(), shifted.getMonth(), shifted.getDate());
  const epoch = new Date(2025,0,1);
  const diff = localMidnight - epoch;
  return Math.floor(diff / (24*60*60*1000));
}

function pickDailyWord(){
  const dayNum = getDayNumber();
  const pool = mode === 4 ? WORDS_4 : WORDS_5;
  const idx = ((dayNum % pool.length) + pool.length) % pool.length;
  answer = pool[idx];
  normalizedAnswer = normalizeArabic(answer);
}

/* ===== Build board ===== */
function buildBoard(){
  boardEl.innerHTML = "";
  boardEl.style.gridTemplateRows = `repeat(${MAX_TRIES}, 1fr)`;
  grid = [];

  for(let r=0;r<MAX_TRIES;r++){
    const rowEl = document.createElement("div");
    rowEl.className = "row";
    rowEl.style.gridTemplateColumns = `repeat(${mode}, 1fr)`;

    const rowArr = [];
    for(let c=0;c<mode;c++){
      const cell = document.createElement("div");
      cell.className = "cell";
      cell.dataset.r = r;
      cell.dataset.c = c;
      rowEl.appendChild(cell);
      rowArr.push("");
    }
    grid.push(rowArr);
    boardEl.appendChild(rowEl);
  }
}

/* ===== Build keyboard ===== */
function buildKeyboard(){
  keyboardEl.innerHTML = "";
  KB_LAYOUT.forEach(rowLetters=>{
    const rowEl = document.createElement("div");
    rowEl.className = "kb-row";

    rowLetters.forEach(k=>{
      const key = document.createElement("div");
      key.className = "key";
      key.dataset.key = k;

      if(k==="Enter" || k==="Backspace") key.classList.add("wide");
      key.textContent = (k==="Enter") ? "Ø¥Ø¯Ø®Ø§Ù„" : (k==="Backspace" ? "Ø­Ø°Ù" : k);

      key.onclick = ()=> handleKey(k);

      rowEl.appendChild(key);
    });

    keyboardEl.appendChild(rowEl);
  });
}

function refreshKeyboardColors(){
  document.querySelectorAll(".key").forEach(k=>{
    const letter = k.dataset.key;
    if(letter==="Enter"||letter==="Backspace") return;
    k.classList.remove("good","close","bad");
    const st = keyStates[letter];
    if(st) k.classList.add(st);
  });
}

/* ===== Render grid ===== */
function render(){
  for(let r=0;r<MAX_TRIES;r++){
    for(let c=0;c<mode;c++){
      const cell = boardEl.querySelector(`.cell[data-r="${r}"][data-c="${c}"]`);
      cell.textContent = grid[r][c] || "";
      cell.classList.toggle("filled", !!grid[r][c]);
    }
  }
  refreshKeyboardColors();
}

/* ===== Messages / Overlay ===== */
function showMsg(text){
  msgEl.textContent = text || "";
}
function showOverlay(title, text){
  overlayTitle.textContent = title;
  overlayText.textContent = text;
  overlay.style.display = "flex";
}
overlayBtn.onclick = ()=> overlay.style.display="none";

/* ===== Check guess (Wordle rules) ===== */
function colorRow(guessArr){
  const guess = guessArr.join("");
  const normGuess = normalizeArabic(guess);
  const ans = normalizedAnswer;

  // counts for letters in answer
  const counts = {};
  for(const ch of ans){
    counts[ch] = (counts[ch]||0)+1;
  }

  const result = Array(mode).fill("bad");

  // first pass: good
  for(let i=0;i<mode;i++){
    if(normGuess[i] === ans[i]){
      result[i] = "good";
      counts[ans[i]]--;
    }
  }
  // second pass: close
  for(let i=0;i<mode;i++){
    if(result[i] === "good") continue;
    const ch = normGuess[i];
    if(counts[ch] > 0){
      result[i] = "close";
      counts[ch]--;
    }
  }

  // apply to cells + keyboard state
  for(let i=0;i<mode;i++){
    const cell = boardEl.querySelector(`.cell[data-r="${row}"][data-c="${i}"]`);
    cell.classList.add(result[i]);

    const letter = guessArr[i];
    const prev = keyStates[letter];

    // priority: good > close > bad
    if(result[i]==="good"){
      keyStates[letter] = "good";
    } else if(result[i]==="close" && prev!=="good"){
      keyStates[letter] = "close";
    } else if(result[i]==="bad" && !prev){
      keyStates[letter] = "bad";
    }
  }

  return normGuess === ans;
}

/* ===== Handle input ===== */
function handleKey(k){
  if(done) return;

  if(k==="Backspace"){
    if(col>0){
      col--;
      grid[row][col] = "";
      render();
    }
    return;
  }

  if(k==="Enter"){
    if(col < mode){
      shakeRow();
      showMsg("Ø§ÙƒÙ…Ù„ Ø§Ù„ÙƒÙ„Ù…Ø© Ø£ÙˆÙ„Ø§Ù‹");
      return;
    }

    const guessArr = grid[row].slice();
    const guess = guessArr.join("");
    const normGuess = normalizeArabic(guess);

    // ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø§Ù„ÙƒÙ„Ù…Ø© ÙÙŠ Ø§Ù„Ù…Ø¹Ø¬Ù…
    const poolNorm = new Set(words.map(w=>normalizeArabic(w)));
    if(!poolNorm.has(normGuess)){
      shakeRow();
      showMsg("Ø§Ù„ÙƒÙ„Ù…Ø© ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯Ø© ÙÙŠ Ø§Ù„Ù…Ø¹Ø¬Ù…");
      return;
    }

    showMsg("");

    const win = colorRow(guessArr);

    saveState();

    if(win){
      done = true;
      showOverlay("ğŸ‰ Ù…Ø¨Ø±ÙˆÙƒ!", "Ø­Ù„Ù‘ÙŠØªÙ‡Ø§ ØµØ­!");
      return;
    }

    row++;
    col=0;

    if(row >= MAX_TRIES){
      done = true;
      showOverlay("Ø§Ù†ØªÙ‡Øª Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø§Øª", `Ø§Ù„ÙƒÙ„Ù…Ø© ÙƒØ§Ù†Øª: ${answer}`);
    }

    render();
    return;
  }

  // Ø­Ø±Ù
  if(col < mode && k.length===1){
    grid[row][col] = k;
    col++;
    render();
  }
}

function shakeRow(){
  const rowEl = boardEl.children[row];
  rowEl.classList.remove("shake");
  void rowEl.offsetWidth;
  rowEl.classList.add("shake");
}

/* ===== Physical keyboard support ===== */
document.addEventListener("keydown", (e)=>{
  if(done) return;

  const key = e.key;

  if(key === "Backspace"){ handleKey("Backspace"); return; }
  if(key === "Enter"){ handleKey("Enter"); return; }

  // Arabic letters
  if(/[\u0600-\u06FF]/.test(key)){
    handleKey(key);
    return;
  }

  // English letters -> ignore (ØªÙ‚Ø¯Ø± ØªØ³ÙˆÙŠ mapping Ù„Ø§Ø­Ù‚Ù‹Ø§)
});

/* ===== LocalStorage (Ø­ÙØ¸ ØªÙ‚Ø¯Ù… Ø§Ù„ÙŠÙˆÙ…) ===== */
function storageKey(){
  return `v9wordle_${mode}_${getDayNumber()}`;
}

function saveState(){
  const data = { grid, row, col, done, keyStates };
  localStorage.setItem(storageKey(), JSON.stringify(data));
}

function loadState(){
  const raw = localStorage.getItem(storageKey());
  if(!raw) return false;
  try{
    const data = JSON.parse(raw);
    if(!data || !Array.isArray(data.grid)) return false;

    grid = data.grid;
    row = data.row ?? 0;
    col = data.col ?? 0;
    done = !!data.done;
    keyStates = data.keyStates || {};
    return true;
  }catch{
    return false;
  }
}

/* ===== Switch mode ===== */
function setMode(m){
  mode = m;
  words = (mode===4) ? WORDS_4 : WORDS_5;

  mode4Btn.classList.toggle("active", mode===4);
  mode5Btn.classList.toggle("active", mode===5);

  pickDailyWord();
  buildBoard();
  buildKeyboard();
  keyStates = {};
  row = 0; col = 0; done=false;

  const loaded = loadState();
  if(!loaded){
    // reset empty
    grid = Array.from({length:MAX_TRIES}, ()=> Array(mode).fill(""));
  }

  render();
  showMsg("");
}

mode4Btn.onclick = ()=> setMode(4);
mode5Btn.onclick = ()=> setMode(5);

/* ===== Boot ===== */
setMode(4);
</script>
<script>
const twitchToken = localStorage.getItem("twitch_access_token");
const twitchUser  = localStorage.getItem("twitch_username");
const TWITCH_CLIENT_ID = "PUT_YOUR_CLIENT_ID_HERE";

const userName   = document.getElementById("twitchUsername");
const userAvatar = document.getElementById("twitchAvatar");

async function loadTwitchUser(){
  if(!twitchToken || !twitchUser){
    userName.textContent = "ØºÙŠØ± Ù…Ø³Ø¬Ù‘Ù„";
    userAvatar.src = "https://placehold.co/32x32?text=?";
    return;
  }

  try{
    const res = await fetch(`https://api.twitch.tv/helix/users?login=${twitchUser}`, {
      headers:{
        "Client-ID": TWITCH_CLIENT_ID,
        "Authorization": `Bearer ${twitchToken}`
      }
    });

    const data = await res.json();
    if(data.data?.length){
      userName.textContent = data.data[0].display_name;
      userAvatar.src = data.data[0].profile_image_url;
    }
  }catch{
    userName.textContent = twitchUser;
    userAvatar.src = "https://placehold.co/32x32?text=?";
  }
}

loadTwitchUser();
</script>

<footer class="foot">2O25 ViRUS, All Rights Reserved Â©</footer>
</body>
</html>
